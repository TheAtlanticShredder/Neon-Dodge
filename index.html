<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cypher Math — neon puzzle arcade</title>
<meta name="theme-color" content="#0b0f1a"><link rel="manifest" href="manifest.webmanifest">
<link rel="icon" sizes="192x192" href="icons/icon-192.png"><link rel="apple-touch-icon" href="icons/icon-192.png">
<style>
:root{--bg:#090c14;--fg:#e6f0ff;--muted:#8ea0b8;--n1:#00f5d4;--n2:#7b61ff;--n3:#ff477e;--n4:#ffd166;}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:radial-gradient(1200px 800px at 70% -10%, #111a2e, transparent 60%),radial-gradient(900px 600px at -10% 110%, #1a1030, transparent 60%), var(--bg);display:flex;align-items:center;justify-content:center;overflow:hidden;}
.wrap{width:min(980px,96vw)}.card{border-radius:18px;background:rgba(255,255,255,.03);box-shadow:0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);backdrop-filter: blur(8px);}header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 18px}
h1{margin:0;font-size:20px;letter-spacing:.6px}.hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.07);font-variant-numeric:tabular-nums}
.btn{cursor:pointer;border:none;padding:10px 14px;border-radius:12px;font-weight:800;color:#0a0a0a;background:linear-gradient(90deg, var(--n1), var(--n2));}.btn:active{transform:translateY(1px)}
select,.tiny{background:rgba(255,255,255,.07);color:var(--fg);border-radius:10px;border:1px solid rgba(255,255,255,.08);padding:8px 10px;font-weight:700}
.canvas-wrap{position:relative;aspect-ratio:16/9;width:100%}canvas{width:100%;height:100%;display:block;border-radius:18px;box-shadow: inset 0 0 0 2px rgba(255,255,255,.06);background:linear-gradient(to bottom, rgba(0,0,0,.2), rgba(0,0,0,.5)), #080a10;}
.scanlines{position:absolute;inset:0;border-radius:18px;pointer-events:none;background: repeating-linear-gradient( to bottom, rgba(255,255,255,.05), rgba(255,255,255,.05) 1px, transparent 2px);mix-blend-mode: overlay;opacity:.22;}
.overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.panel{text-align:center;max-width:86%;pointer-events:auto}.title{font-size:28px;font-weight:900;margin-bottom:8px}.muted{color:var(--muted);font-size:14px}.big{font-size:18px}
.kbd{font-family:ui-monospace,Menlo,monospace;font-weight:800;padding:2px 6px;border-radius:6px;background:rgba(255,255,255,.08)}.hidden{display:none}footer{text-align:center;color:var(--muted);font-size:12px;margin:10px 0}
.token{display:inline-block;min-width:34px;padding:6px 10px;border-radius:10px;background:rgba(255,255,255,.06);margin:0 4px;box-shadow:0 0 10px rgba(123,97,255,.35) inset;}
.board{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:6px}.board .slot{width:42px;height:38px;border-radius:10px;background:rgba(255,255,255,.05);border:1px dashed rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:18px}
.modebar{display:flex;gap:8px;align-items:center}
</style></head>
<body><div class="wrap"><div class="card"><header>
<div class="modebar"><h1>CYHER MATH</h1>
<select id="mode"><option value="arcade">Arcade</option><option value="puzzle">Puzzle</option></select>
<select id="difficulty"><option value="easy">Easy</option><option value="normal" selected>Normal</option><option value="hard">Hard</option></select>
<button id="btnPause" class="btn tiny" title="Pause (P)">Pause</button></div>
<div class="hud"><div class="pill">Target: <span id="target">0</span></div><div class="pill">Slots: <span id="slots">5</span></div><div class="pill">Score: <span id="score">0</span></div><div class="pill">Streak: <span id="streak">0</span></div><div class="pill">Acc: <span id="acc">100%</span></div><div class="pill hidden" id="timerPill">Time: <span id="timer">60</span>s</div></div>
</header><div class="canvas-wrap"><canvas id="game" width="960" height="540"></canvas><div class="scanlines"></div>
<div id="start" class="overlay"><div class="panel"><div class="title">Collect. Compute. Survive.</div>
<div class="big">Grab <span class="token">digits</span> and <span class="token">operators</span> to build an expression that equals the <b>Target</b>.</div>
<div class="muted" style="margin:10px 0 16px">WASD / Arrows to move. Backspace to undo. In Puzzle mode there are no enemies, but you’re timed.</div>
<div class="board" id="boardPreview"></div><button id="btnStart" class="btn">Start</button></div></div>
<div id="gameover" class="overlay hidden"><div class="panel"><div class="title">Run complete</div>
<div class="big">Score: <span id="final">0</span> | Best: <span id="best">0</span></div>
<div class="muted" style="margin:10px 0 16px">Tip: Use short, elegant expressions for higher streak multipliers.</div>
<button id="btnRetry" class="btn">Play Again</button></div></div></div>
<footer>© Cypher Math — PWA build</footer></div></div>
<script>
(function(){
  const cv=document.getElementById('game');const ctx=cv.getContext('2d');const dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1));cv.width=960*dpr;cv.height=540*dpr;ctx.scale(dpr,dpr);
  const modeSel=document.getElementById('mode');const diffSel=document.getElementById('difficulty');const btnPause=document.getElementById('btnPause');
  const elTarget=document.getElementById('target');const elSlots=document.getElementById('slots');const elScore=document.getElementById('score');const elStreak=document.getElementById('streak');const elAcc=document.getElementById('acc');
  const elTimerPill=document.getElementById('timerPill');const elTimer=document.getElementById('timer');const elFinal=document.getElementById('final');const elBest=document.getElementById('best');
  const elStart=document.getElementById('start');const elGameOver=document.getElementById('gameover');const btnStart=document.getElementById('btnStart');const btnRetry=document.getElementById('btnRetry');
  const boardPreview=document.getElementById('boardPreview');
  function makeSlots(n){boardPreview.innerHTML='';for(let i=0;i<n;i++){const d=document.createElement('div');d.className='slot';d.textContent='';boardPreview.appendChild(d);}}
  const state={running:false,paused:false,over:false,w:960,h:540,t:0,last:0,dt:0,player:{x:480,y:270,r:10,vx:0,vy:0,speed:220,inv:0},shards:[],tokens:[],particles:[],spawnT:0,tokenT:0,score:0,best:Number(localStorage.getItem('cyphermath_best')||0),streak:0,correct:0,attempts:0,target:0,needSlots:5,input:[],mode:'arcade',timeLeft:60};
  function rng(min,max){return Math.random()*(max-min)+min}function clamp(v,a,b){return Math.max(a,Math.min(b,v))}function circleHit(a,b){const dx=a.x-b.x,dy=a.y-b.y;return (dx*dx+dy*dy)<=(a.r+b.r)*(a.r+b.r)}function choice(arr){return arr[Math.floor(Math.random()*arr.length)]}
  function setMode(m){state.mode=m;elTimerPill.classList.toggle('hidden',m!=='puzzle')}modeSel.addEventListener('change',e=>setMode(e.target.value));
  function difficultySlots(){const d=diffSel.value;return d==='easy'?3:d==='hard'?7:5}
  function newTarget(){state.needSlots=difficultySlots();elSlots.textContent=state.needSlots;makeSlots(state.needSlots);state.input=[];const base=diffSel.value==='easy'?10:diffSel.value==='hard'?50:25;state.target=Math.floor(rng(base,base*2));elTarget.textContent=state.target;}
  function evalExpression(arr){try{if(arr.length===0)return null;const s=arr.join('');if(/^[+\-*/]/.test(s))return null;if(!/^[0-9+\-*/() ]+$/.test(s))return null;const val=Function(`"use strict";return (${s});`)();return Number.isFinite(val)?val:null;}catch(e){return null;}}
  function submitIfFull(){if(state.input.length<state.needSlots)return;state.attempts++;const v=evalExpression(state.input);const ok=(v!==null&&Math.round(v)===state.target);if(ok){state.correct++;state.streak++;state.score+=Math.max(10,50-state.input.length*3)*(1+state.streak*0.2);addBurst(state.player.x,state.player.y,'#00f5d4');newTarget();if(state.mode==='arcade'){state.shards.splice(0,Math.min(3,state.shards.length));}else{state.timeLeft=Math.min(120,state.timeLeft+6);} }else{state.streak=0;if(state.mode==='arcade'){for(let i=0;i<3;i++)spawnShard(true);}else{state.timeLeft=Math.max(0,state.timeLeft-6);}addBurst(state.player.x,state.player.y,'#ff477e');state.input=[];}}
  function accStr(){const a=state.attempts>0?Math.round((state.correct/state.attempts)*100):100;return a+'%'}
  function reset(){state.t=0;state.last=0;state.dt=0;state.over=false;state.paused=false;state.player.x=state.w/2;state.player.y=state.h/2;state.player.vx=0;state.player.vy=0;state.player.inv=1;state.score=0;state.streak=0;state.correct=0;state.attempts=0;state.timeLeft=60;state.shards.length=0;state.tokens.length=0;state.particles.length=0;newTarget();}
  function start(){reset();state.running=true;elStart.classList.add('hidden');elGameOver.classList.add('hidden');}
  function gameOver(){state.running=false;state.over=true;elFinal.textContent=state.score.toFixed(0);if(state.score>state.best){state.best=state.score;localStorage.setItem('cyphermath_best',state.score.toFixed(0));}if(elBest)elBest.textContent=state.best;elGameOver.classList.remove('hidden');}
  if(btnStart)btnStart.addEventListener('click',start);if(btnRetry)btnRetry.addEventListener('click',start);btnPause.addEventListener('click',()=>{state.paused=!state.paused;btnPause.textContent=state.paused?'Resume':'Pause';});
  const keys=new Set();window.addEventListener('keydown',(e)=>{if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d','W','A','S','D',' '].includes(e.key))e.preventDefault();if(e.key==='p'||e.key==='P'){state.paused=!state.paused;btnPause.textContent=state.paused?'Resume':'Pause';}if(e.key==='Backspace'){state.input.pop();}if(e.key==='Enter'){submitIfFull();}keys.add(e.key.toLowerCase());});window.addEventListener('keyup',(e)=>keys.delete(e.key.toLowerCase()));
  function spawnShard(near){const edge=Math.floor(Math.random()*4);let x,y;if(near){x=state.player.x+rng(-120,120);y=state.player.y+rng(-120,120);}else{if(edge===0){x=-20;y=rng(0,state.h);}else if(edge===1){x=state.w+20;y=rng(0,state.h);}else if(edge===2){x=rng(0,state.w);y=-20;}else{x=rng(0,state.w);y=state.h+20;}}const ang=Math.atan2(state.player.y-y,state.player.x-x)+(Math.random()*0.6-0.3);const sp=80+rng(0,50)+(state.score*0.01);state.shards.push({x,y,vx:Math.cos(ang)*sp,vy:Math.sin(ang)*sp,r:8+rng(0,7),life:12});}
  function spawnToken(){const isOp=Math.random()<0.28;const val=isOp?choice(['+','-','*','/']):String(Math.floor(Math.random()*10));state.tokens.push({x:rng(40,state.w-40),y:rng(40,state.h-40),r:12,val,t:8});}
  function addBurst(x,y,col){for(let i=0;i<12;i++){const a=Math.random()*Math.PI*2;const s=60+Math.random()*120;state.particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:.6+Math.random()*.4,col});}}
  function update(){if(state.last===0)state.last=performance.now();const now=performance.now();state.dt=Math.min(0.033,(now-state.last)/1000);state.last=now;if(state.paused)return;state.t+=state.dt;if(state.mode==='puzzle'){state.timeLeft-=state.dt;if(state.timeLeft<=0)return gameOver();elTimer.textContent=Math.ceil(state.timeLeft);}let ax=0,ay=0;if(keys.has('arrowleft')||keys.has('a'))ax-=1;if(keys.has('arrowright')||keys.has('d'))ax+=1;if(keys.has('arrowup')||keys.has('w'))ay-=1;if(keys.has('arrowdown')||keys.has('s'))ay+=1;const mag=Math.hypot(ax,ay)||1;const sp=state.player.speed;state.player.vx=(ax/mag)*sp;state.player.vy=(ay/mag)*sp;state.player.x=clamp(state.player.x+state.player.vx*state.dt,10,state.w-10);state.player.y=clamp(state.player.y+state.player.vy*state.dt,10,state.h-10);if(state.player.inv>0)state.player.inv-=state.dt;state.spawnT-=state.dt;state.tokenT-=state.dt;if(state.mode==='arcade' && state.spawnT<=0){spawnShard(false);state.spawnT=Math.max(0.25,1.0-Math.min(0.7,state.score*0.0015));}if(state.tokenT<=0){spawnToken();state.tokenT=1.2-Math.min(0.7,state.score*0.001)+Math.random()*0.4;}for(let i=state.shards.length-1;i>=0;i--){const s=state.shards[i];s.x+=s.vx*state.dt;s.y+=s.vy*state.dt;s.life-=state.dt*0.05;if(s.x<-60||s.x>state.w+60||s.y<-60||s.y>state.h+60){state.shards.splice(i,1);continue;}if(state.mode==='arcade'&&circleHit({x:s.x,y:s.y,r:s.r},{x:state.player.x,y:state.player.y,r:state.player.r})&&state.player.inv<=0){return gameOver();}}for(let i=state.tokens.length-1;i>=0;i--){const tk=state.tokens[i];tk.t-=state.dt;if(tk.t<=0){state.tokens.splice(i,1);continue;}if(circleHit({x:tk.x,y:tk.y,r:tk.r},{x:state.player.x,y:state.player.y,r:state.player.r})){if(state.input.length<state.needSlots){state.input.push(tk.val);state.tokens.splice(i,1);const L=state.input.length;if((L===1&&['+','-','*','/'].includes(state.input[0]))||(L>=2&&['+','-','*','/'].includes(state.input[L-1])&&['+','-','*','/'].includes(state.input[L-2]))){state.streak=0;if(state.mode==='arcade'){spawnShard(true);}else{state.timeLeft=Math.max(0,state.timeLeft-3);}}if(state.input.length===state.needSlots)submitIfFull();}else{state.tokens.splice(i,1);}}}elScore.textContent=Math.floor(state.score);elStreak.textContent=state.streak;elAcc.textContent=accStr();}
  function draw(){const w=960,h=540;ctx.clearRect(0,0,w,h);ctx.save();ctx.globalAlpha=0.09;ctx.strokeStyle='#7b61ff';ctx.lineWidth=1;const gap=40;for(let x=0;x<=w;x+=gap){ctx.beginPath();ctx.moveTo(x+0.5,0);ctx.lineTo(x+0.5,h);ctx.stroke();}for(let y=0;y<=h;y+=gap){ctx.beginPath();ctx.moveTo(0,y+0.5);ctx.lineTo(w,y+0.5);ctx.stroke();}ctx.restore();const pl=state.player;ctx.save();ctx.shadowBlur=20;ctx.shadowColor='#00f5d4';ctx.beginPath();ctx.fillStyle=pl.inv>0?'rgba(0,245,212,0.5)':'#00f5d4';ctx.arc(pl.x,pl.y,pl.r,0,Math.PI*2);ctx.fill();ctx.restore();for(const s of state.shards){ctx.save();ctx.shadowBlur=14;ctx.shadowColor='#ff477e';ctx.fillStyle='#ff477e';ctx.translate(s.x,s.y);ctx.rotate(Math.atan2(s.vy,s.vx));ctx.beginPath();ctx.moveTo(-s.r,0);ctx.lineTo(0,-s.r*0.7);ctx.lineTo(s.r,0);ctx.lineTo(0,s.r*0.7);ctx.closePath();ctx.fill();const len=24;const grad=ctx.createLinearGradient(-len,0,s.r,0);grad.addColorStop(0,'rgba(255,71,126,0)');grad.addColorStop(1,'rgba(255,71,126,.55)');ctx.fillStyle=grad;ctx.fillRect(-len,-2,len,4);ctx.restore();}
  for(const tk of state.tokens){const col=['+','-','*','/'].includes(tk.val)?'#ffd166':'#7b61ff';ctx.save();ctx.shadowBlur=16;ctx.shadowColor=col;ctx.fillStyle=col;ctx.beginPath();ctx.arc(tk.x,tk.y,tk.r,0,Math.PI*2);ctx.fill();ctx.fillStyle='#0a0a0a';ctx.font='900 16px ui-sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(tk.val,tk.x,tk.y+1);ctx.restore();}
  const s=state.input.join(' ')||'—';ctx.save();ctx.globalAlpha=.85;ctx.fillStyle='rgba(255,255,255,.06)';ctx.fillRect(10,h-54,w-20,44);ctx.strokeStyle='rgba(255,255,255,.12)';ctx.strokeRect(10.5,h-54.5,w-21,44);ctx.fillStyle='#e6f0ff';ctx.font='900 18px ui-sans-serif';ctx.textAlign='left';ctx.textBaseline='middle';ctx.fillText('Expression: '+s,20,h-32);ctx.fillStyle='#8ea0b8';ctx.font='700 12px ui-sans-serif';ctx.fillText('Backspace = undo • Enter = submit',w-260,h-16);ctx.restore();}
  function frame(){if(state.running){update();draw();}requestAnimationFrame(frame);}frame();setMode(modeSel.value);makeSlots(difficultySlots());
  if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(console.error));}
})();
</script></body></html>